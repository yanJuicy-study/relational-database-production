# 04 정규화 이론 - 결합 종속성

# 결합 종속성(JD)

4NF 이후는 결합 종속성에 대한 정규화다.

릴레이션 내에 명백하지 않은 결합 종속성이 있으면 그 릴레이션은 4NF ~ 6NF 정규화 대상이다.

결합 종속성은 키 자체에 다중성이 포함됐을 때 나타나는 중복을 말한다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6f0ddba0-a20a-47b4-a5f8-4c2a8be21add/Untitled.png)

## 결합 종속성은 무손실 분해가 가능

결합 종속성은 프로젝션으로 나눈 릴레이션을 다시 결합하면 원래의 릴레이션으로 돌아가는 성질이다.

무손실 분해가 가능한 것을 결합 종속성이라고 하므로 무손실 분해가 가능하다.

## 함수 종속성은 결합 종속성의 일종이다

무손실 분해가 가능한 것을 결합 종속성이라고 한다.

함수 종속성도 결합 종속성의 일종이다.

함수 종속성은 특징이 있어서 쉽게 찾을 수 있다는 점이 다르다.

## 암시적인 결합 종속성

[이름]이라는 공통의 후보키를 갖는 두 릴레이션으로 나눈다.

튜플의 수가 같으면서 키가 아닌 속성만 다른 릴레이션만 두 개 생성된다.

| 이름 | 나이 | 학년 |
| --- | --- | --- |
| 정은오 | 20 | 2 |
| 홍윤서 | 23 | 3 |
| 오민혀 | 19 | 1 |

같은 후보키를 가지고 있는 튜플끼리 원래 릴레이션을 만들 수 있다.

이와 같은 결합 종속성은 슈퍼키에 의해 암시적으로 정의도니다.

| 이름 | 나이 |
| --- | --- |
| 정은오 | 20 |
| 홍윤서 | 23 |
| 오민혀 | 19 |

| 이름 | 학년 |
| --- | --- |
| 정은오 | 2 |
| 홍윤서 | 3 |
| 오민혀 | 1 |

## 키가 아닌 속성과 결합 종속성

4NF 이후의 정규화를 판단하는 데 있어 중요한 것이 키가 아닌 속성의 유무다.

키가 아닌 속성이 존재하면 RK→(키가 아닌 속성)이라는 명시적인 함수 종속성이 존재한다.

프로젝션으로 후보키를 나누면 함수 종속성이 사라지므로 무손실 분해를 할 수 없다.

→ 더 이상 정규화를 진행할 수 없다는 의미 같음

4NF, 5NF가 되도록 정규화하는 작업은 키가 아닌 속성이 존재하지 않는 릴레이션만 대상이 된다.

4NF, 5NF로의 정규화는 후보키에 여러 속성이 포함되는 경우인 복합키일 때만 필요한 작업이다.

- 후보키 1개로는 더 이상 프로젝션으로 분해할 수 없다.

# 결합 종속성에 의한 정규화 (4NF ~ 6NF)

## 제 4 정규형 (4NF)

4NF는 일반적으로 ‘다치 종속성(MVD)에 의한 정규화’ 라고 설명돼 있다.

MVD는 결합 종속성의 특수한 경우다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6f4f7d6d-a326-472e-b4f8-f1943556600a/Untitled.png)

키가 아닌 속성을 갖지 않는 릴레이션을 결합 종속성에 의해 공통의 속성을 포함한 두 개의 릴레이션으로 무손실 분해할 수 있는 것이 MVD다.

다음은 MVD를 갖는 릴레이션의 예다.

| 이름 | 학과 | 수업 |
| --- | --- | --- |
| 정은오 | 컴퓨터 아키텍처 | 관계형 모델 |
| 홍윤서 | 컴파일러 | 관계형 모델 |
| 오민혁 | 컴파일러 | 관계형 모델 |
| 오민혁 | 컴파일러 | 컴퓨터 아키텍처 원리 |

명백하지 않은 결합 종속성을 해소하려면 프로젝션으로 무손실 분해한다.

| 이름 | 학과 |
| --- | --- |
| 정은오 | 컴퓨터 아키텍처 |
| 홍윤서 | 컴파일러 |
| 오민혁 | 컴파일러 |

| 이름 | 수업 |
| --- | --- |
| 정은오 | 관계형 모델 |
| 홍윤서 | 컴파일러 |
| 오민혁 | 컴파일러 |
| 오민혁 | 컴퓨터 아키텍처 원리 |

## 제 5 정규형

5NF는 마지막 정규형이다. 이 이상은 릴레이션을 분해해도 의미가 없다.

5NF에서는 명백하지 않거나 암시적이지 않은 모든 결합 종속성이 제거된 상태를 나타낸다.

4NF는 MVD라는 결합 종속성이 제거된 정규형이지만, 그 외의 명백하거나 암시적이지 않은 결합 종속성을 제거하는 것이 5NF의 작업이다.

아래 테이블에 “OO 수업은 OO 학과인 사람만 수강할 수 있다”는 규칙이 생기면, { 학과, 수업 }이라는 릴레이션이 필요하다.

| 이름 | 학과 | 수업 |
| --- | --- | --- |
| 정은오 | 컴퓨터 아키텍처 | 컴퓨터 아키텍처 원리 |
| 홍윤서 | 컴파일러 | 관계형 모델 |
| 오민혁 | 컴파일러 | 관계형 모델 |
| 오민혁 | 컴파일러 | 컴파일러 |

| 이름 | 학과 |
| --- | --- |
| 정은오 | 컴퓨터 아키텍처 |
| 홍윤서 | 컴파일러 |
| 오민혁 | 컴파일러 |

| 학과 | 수업 |
| --- | --- |
| 컴퓨터 아키텍처 | 컴퓨터 아키텍처 원리 |
| 컴파일러 | 관계형 모델 |
| 컴파일러 | 컴파일러 |

| 이름 | 수업 |
| --- | --- |
| 정은오 | 관계형 모델 |
| 홍윤서 | 컴파일러 |
| 오민혁 | 컴파일러 |
| 오민혁 | 컴퓨터 아키텍처 원리 |

### 연결의 함정

위 그림에서는 한 개의 릴레이션이 결합 종속성에 의해 세 개로 분해됐다.

세 개 이상의 릴레이션으로 분해되는 결합 종속성을 “연결의 함정”이라고 한다.

- 분해된 후에 세 개의 릴레이션은 원래의 릴레이션과 같은 사실을 나타낸다고 보이지 않는다.
- 이것은 얼핏 보기에 함정처럼 보일 뿐 실제는 아무런 함정도 없다.
1. 오민혁은 컴파일러 학과에 소속돼 있고 어떤 수업을 수강한다.
2. 오민혁은 어떤 학과에 소속돼 있고 관계형 모델의 수업을 수강한다.
3. 어떤 학생은 컴파일러 학과에 소속돼 있고 관계형 모델의 수업을 수강한다.
4. 오민혁은 컴파일러 학과에 소속돼 있고 관계형 모델의 수업을 수강한다.
    - 일반적인 논리학에서는 1~3이 참이어도 4의 명제가 도출되지 않는다.
    - “1 ^ 2 ^ 3 ⇒ 4” 이런 명제는 성립하지 않는다.
    - 이처럼 분해 후의 릴레이션이 원래의 릴레이션과 같은 사실을 나타내고 있지 않은 것처럼 보이는 현상을 연결의 함정이라고 한다.

### 곱집합과 결합 종속성

5NF는 MVD에서도 암시적이지 않은 결합 종속성을 다룬다.

이와 같은 결합 종속성 중에 가장 단순한 것은 한 개의 속성만 가지는 두 릴레이션의 곱집합이다.

두 개의 속성만 있고 키가 아닌 속성이 없는 릴레이션이 무손실 분해가 가능한 경우는 위와 같은 곱집합인 경우다.

다음과 같은 릴레이션이 있다면 무손실 분해를 하자.

| 개 | 고양이 |
| --- | --- |
| 몰리 | 시시 |
| 몰리  | 호야 |
| 사랑이 | 시시 |
| 하나 | 호야 |
| 하나  | 시시 |

### 결합 종속성을 발견하기 어렵다?

함수 종속성의 경우, 무손실 분해를 하는 경우는 반드시 키가 아닌 속성이 포함된다는 특징이 있다.

키가 아닌 속성은 후보키에 함수 종속성이 있어서 비대칭적인 관계라고 할 수 있다.

비대칭성은 눈에 잘 띄므로 함수 종속성은 비교적 발견하기 쉽다.

4NF, 5NF에서 다루는 함수 종속성은 양쪽 모두 키가 아닌 속성을 가지지 않는 릴레이션끼리 결합한 상태의 것이다.

무손실 분해를 하면 함수 종속성처럼 키가 아닌 속성을 포함한 릴레이션이 생성되는 것이 아니라 릴레이션에 포함되는 속성이 대칭 관계성을 갖게 된다.

결합 종속성이 존재하는지 아닌지를 판별하는 방법은 실제로 프로젝션을 해 다시 결합해보는 방법이 있다.

결합한 다음에 릴레이션이 원래의 릴레이션과 같다면 결합 종속성이 존재할 가능성이 있다.

## 제 6 정규형 (6NF)

6NF는 명백한 결합 종속성만 남을 때까지 가능한 모든 결합 종속성을 제외한 상태의 정규형이다.

6NF에서 제외되는 결합 종속성은 암시적 결합 종속성도 포함된다.

극한까지 키가 아닌 속성의 개수가 0 또는 1이 될 때까지 무손실 분해가 된 상태가 6NF 다.

DB 설계는 일반적으로 5NF까지 한다.
